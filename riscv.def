	.nolist
; Definitions for the Risc-V processor

	.param codewidth = 32
        .param pcwidth = 8

	.pushmem ram
	.defmem bottom = 0x0
	.defmem top = 0xffffffff
	.defmem width = 32
	.defmem executable = 1
	.defmem writeable = 1
	.defmem readable = 1
	.defmem init = 1
	.defmem label = ''
	.defmem pcwidth = 8
        .defmem pcinc = 4
	.popmem
	
	.macro .ram
	.pushmem ram
	.endm
	
	.macro .dseg
	.pushmem ram
	.endm

# RV32I base instruction set
 .isa riscv
 .instruction r    add        0x00000033
 .instruction u    lui        0x00000037
 .instruction u    auipc      0x00000017
 .instruction uj   jal        0x0000006f
 .macro j
 jal x0, @0
 .endm
 .instruction i    jalr       0x00000067
 .macro jr
 jalr x0, @0, 0
 .endm
 .instruction sb   beq        0x00000063
 .macro beqz
 beq @0, x0, @1
 .endm
 .instruction sb   bne        0x00001063
 .macro bnez
 bne @0, x0, @1
 .endm
 .instruction sb   blt        0x00004063
 .macro bgt
 blt @1, @0, @2
 .endm
 .instruction sb   bge        0x00005063
 .macro ble
 bge @1, @0, @2
 .endm
 .instruction sb   bltu       0x00006063
 .macro bgtu
 bltu @1, @0, @2
 .endm
 .instruction sb   bgeu       0x00007063
 .macro bleu
 bgeu @1, @0, @2
 .endm
 .instruction i    lb         0x00000003
 .instruction i    lh         0x00001003
 .instruction i    lw         0x00002003
 .instruction i    lbu        0x00004003
 .instruction i    lhu        0x00005003
 .instruction s    sb         0x00000023
 .instruction s    sh         0x00001023
 .instruction s    sw         0x00002023
 .instruction i    addi       0x00000013
 .macro mv
 addi @0, @1, 0
 .endm
 .macro nop
 addi x0, x0, 0
 .endm
 .macro li
 addi @0, x0, @1
 .endm
 .instruction i    slti       0x00002013
 .instruction i    sltiu      0x00003013
 .macro seqz
 sltiu @0, @1, 1
 .endm
 .instruction i    xori       0x00004013
 .macro not
 xori @0, @1, -1
 .endm
 .instruction i    ori        0x00006013
 .instruction i    andi       0x00007013
 .instruction sh   slli       0x00001013
 .instruction sh   srli       0x00005013
 .instruction sh   srai       0x40005013
 .instruction r    add        0x00000033
 .instruction r    sub        0x40000013
 .instruction r    sll        0x00001033
 .instruction r    slt        0x00002033
 .instruction r    sltu       0x00003033
 .macro snez
 sltu @0, x0, @1
 .endm
 .instruction r    xor        0x00004033
 .instruction r    srl        0x00005033
 .instruction r    sra        0x40005033
 .instruction r    or         0x00006033
 .instruction r    and        0x00007033
 .instruction fence fence     0x0000000f
 .instruction inh  fence.i    0x0000100f
 .instruction inh  scall      0x00000073
 .instruction inh  sbreak     0x00100073
 .instruction rd   rdcycle    0xc0002073
 .instruction rd   rdcycleh   0xc8002073
 .instruction rd   rdtime     0xc0102073
 .instruction rd   rdtimeh    0xc8102073
 .instruction rd   rdinstret  0xc0202073
 .instruction rd   rdinstreth 0xc8202073

# RV64I base instruction set
 .instruction i    lwu        0x00006003
 .instruction i    ld         0x00003003
 .instruction s    sd         0x00001013
 .instruction lsh  slli       0x00002013
 .instruction lsh  srli       0x00005013
 .instruction lsh  srai       0x40005013
 .instruction i    addiw      0x0000001b
 .macro sext.w
 addiw @0, @1, 0
 .endm
 .instruction sh   slliw      0x0000101b
 .instruction sh   srliw      0x0000501b
 .instruction sh   sraiw      0x4000501b
 .instruction r    addw       0x0000003b
 .instruction r    subw       0x4000003b
 .instruction r    sllw       0x0000103b
 .instruction r    srlw       0x0000503b
 .instruction r    sraw       0x4000503b

# RV32M standard extension
 .instruction r    mul        0x02000033
 .instruction r    mulh       0x02002033
 .instruction r    mulhsu     0x02004033
 .instruction r    div        0x02006033
 .instruction r    divu       0x0200a033
 .instruction r    rem        0x0200c033
 .instruction r    remu       0x0200e033

# RV64M standard extension
 .instruction r    mulw       0x0200003b
 .instruction r    divw       0x0200803b
 .instruction r    divuw      0x0200a03b
 .instruction r    remw       0x0200c03b
 .instruction r    remuw      0x0200e03b

# RV32A standard extension
 .instruction ra0  lr.w       0x1000402f
 .instruction ra   sc.w       0x1800402f
 .instruction ra   amoswap.w  0x0800402f
 .instruction ra   amoadd.w   0x0000402f
 .instruction ra   amoxor.w   0x2000402f
 .instruction ra   amoand.w   0x6000402f
 .instruction ra   amoor.w    0x4000402f
 .instruction ra   amomin.w   0x8000402f
 .instruction ra   amomax.w   0xa000402f
 .instruction ra   amominu.w  0xc000402f
 .instruction ra   amomaxu.w  0xe000402f

# RV64A standard extension
 .instruction ra0  lr.d       0x1000602f
 .instruction ra   sc.d       0x1800602f
 .instruction ra   amoswap.d  0x0800602f
 .instruction ra   amoadd.d   0x0000602f
 .instruction ra   amoxor.d   0x4000602f
 .instruction ra   amoand.d   0x6000602f
 .instruction ra   amoor.d    0x4000602f
 .instruction ra   amomin.d   0x8000602f
 .instruction ra   amomax.d   0xa000602f
 .instruction ra   amominu.d  0xc000602f
 .instruction ra   amomaxu.d  0xe000602f

# RV32F standard extension
 .instruction fi   flw        0x00002007
 .instruction fs   fsw        0x00002027
 .instruction fr4  fmadd.s    0x00000043
 .instruction fr4  fmsub.s    0x00000047
 .instruction fr4  fnmsub.s   0x0000004b
 .instruction fr4  fnmadd.s   0x0000004f
 .instruction fr   fadd.s     0x00000053
 .instruction fr   fsub.s     0x08000053
 .instruction fr   fmul.s     0x10000053
 .instruction fr   fdiv.s     0x18000053
 .instruction fr2  fsqrt.s    0x58000053 
 .instruction fr   fsgnj.s    0x20000053
 .instruction fr   fsgnjn.s   0x20001053
 .instruction fr   fsgnjx.s   0x20002053
 .instruction fr   fmin.s     0x28000053
 .instruction fr   fmax.s     0x28001053
 .instruction fr2  fcvt.w.s   0xc0000053
 .instruction fr2  fcvt.wu.s  0xc0100053
 .instruction fr2  fmv.x.s    0xe0000053
 .instruction fr   feq.s      0xa0002053
 .instruction fr   flt.s      0xa0001053
 .instruction fr   fle.s      0xa0000053
 .instruction fr2  fclass.s   0xe0001053
 .instruction fr2  fcvt.s.w   0xd0000053
 .instruction fr2  fcvt.s.wu  0xd0100053
 .instruction fr2  fmv.s.x    0xf0000053
 .instruction rd   frcsr      0x00302073
 .instruction rd   frrm       0x00202073
 .instruction rd   frflags    0x00102073
 .instruction r2   fscsr      0x00301073
 .instruction r2   fsrm       0x00201073
 .instruction r2   fsflags    0x00101073
 .instruction rd   fsrmi      0x00205073 ; which immediate field?
 .instruction rd   fsflagsi   0x00105073 ; and here also

# RV64F standard extension
 .instruction fr2  fcvt.l.s   0xc0200053 ; integer registers?
 .instruction fr2  fcvt.lu.s  0xc0300053
 .instruction fr2  fcvt.s.l   0xd0200053
 .instruction fr2  fcvt.s.lu  0xd0300053

# RV32D standard extension
 .instruction fi   fld        0x00003003
 .instruction fs   fsd        0x00003023
 .instruction fr4  fmadd.d    0x02000043
 .instruction fr4  fmsub.d    0x02000047
 .instruction fr4  fnmsub.d   0x0200004b
 .instruction fr4  fnmadd.d   0x0200004f
 .instruction fr   fadd.d     0x02000053
 .instruction fr   fsub.d     0x0a000053
 .instruction fr   fmul.d     0x12000053
 .instruction fr   fdiv.d     0x1a000053
 .instruction fr2  fsqrt.d    0x5a000053
 .instruction fr   fsgnj.d    0x22000053
 .instruction fr   fsgnjn.d   0x22002053
 .instruction fr   fsgnjx.d   0x22004053
 .instruction fr   fmin.d     0x2a000053
 .instruction fr   fmax.d     0x2a002053
 .instruction fr2  fcvt.s.d   0x40100053
 .instruction fr2  fcvt.d.s   0x42000053
 .instruction fr   feq.d      0xa2004053
 .instruction fr   flt.d      0xa2002053
 .instruction fr   fle.d      0xa2000053
 .instruction fr2  fclass.d   0xe2002053
 .instruction fr2  fcvt.w.d   0xc2000053
 .instruction fr2  fcvt.wu.d  0xc2100053
 .instruction fr2  fcvt.d.w   0xd2000053
 .instruction fr2  fcvt.d.wu  0xd2100053

# RV64D standard extension
 .instruction fr2  fcvt.l.d   0xc2200053
 .instruction fr2  fcvt.lu.d  0xc2300053
 .instruction fr2  fmv.x.d    0xe2000053
 .instruction fr2  fcvt.d.l   0xd2200053
 .instruction fr2  fcvt.d.lu  0xd2300053
 .instruction fr2  fmv.d.x    0xf2000053

 .assemble

 .arch riscv

 .list
